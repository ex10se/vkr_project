<div id="app-center" fxFlex="100" fxLayoutAlign="center" fxLayout="row wrap">

  <div fxFlex="70" fxLayout="row wrap" fxLayoutAlign="center" fxLayoutGap="10px">
    <mat-card class="example-card" *ngFor="let product of products"
              fxFlex="300px" fxLayout="column wrap"
              fxLayoutAlign="center">
      <mat-card-header>
        <div mat-card-avatar class="example-header-image">
          <a href="#" [routerLink]="['/catalog/cat/',product['category']['id']]">
            <img class="cat-img" src="{{ product['category']['image_url'] }}"
                 [alt]="product['category']['name']" [title]="product['category']['name']">
          </a>
        </div>
        <mat-card-title>{{ product['name'] }}</mat-card-title>
        <mat-card-subtitle class="category-title">
          <button mat-flat-button
                  [routerLink]="['/catalog/cat/',product['category']['id']]">{{ product['category']['name'] }}</button>
        </mat-card-subtitle>
        <mat-card-subtitle class="subcategory-title">
          <button mat-flat-button
                  [routerLink]="['/catalog/subcat/',product['subcategory']['id']]">{{ product['subcategory']['name'] }}</button>
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content fxFlex fxLayoutAlign="space-around flex-end">
        <!--  TODO фотография продукта - модалка с инфой о нем и крупной фоткой -->
        <img mat-card-image [src]="product['get_small_image_url']" [alt]="product['name']"
             lightbox [fullImage]="{path: product['image'] }">
        <div id="description">
          <!-- Временное решение: TODO описание продукта -->
          <span>{{product['id']}} {{ product['name'].slice(0, product['name'].indexOf(' ')) }}</span>

          <span *ngIf="!isAuth">
            <ngb-rating [(rate)]="product['get_common_rating']" [max]="5" [readonly]=true>
              <ng-template let-fill="fill">
                <span class="star" [class.full]="fill === 100">
                  <span class="half" [style.width.%]="fill">&#9733;</span>&#9733;
                </span>
              </ng-template>
            </ngb-rating>
          </span>

          <span *ngIf="isAuth">{{product['get_common_rating']}}
            <ngb-rating [rate]="product['get_common_rating']" [max]="5" [readonly]=false>
<!--                        (rateChange)="doSetProductRating(user, product['id'], )">-->
              <ng-template let-fill="fill">
                <span class="star" [class.full]="fill === 100">
                  <span class="half" [style.width.%]="fill">&#9733;</span>&#9733;
                </span>
              </ng-template>
            </ngb-rating>
          </span>

        </div>
      </mat-card-content>
      <mat-card-actions>
        <!--  TODO анимация загрузки товаров -->
        <!--  TODO поиск товара -->
        <button class="price" mat-stroked-button disabled>{{product['get_price']}} ₽</button>
        <mat-button-toggle-group (wheel)="onWheel(product, $event)">
          <mat-button-toggle class="count" disabled>{{product['amount']}} шт</mat-button-toggle>
          <mat-button-toggle-group vertical class="plus-minus-group">
            <mat-button-toggle class="plus-minus" (click)="product['amount'] = product['amount'] + 1">+
            </mat-button-toggle>
            <mat-button-toggle class="plus-minus" (click)="product['amount'] = product['amount'] - 1">-
            </mat-button-toggle>
          </mat-button-toggle-group>
        </mat-button-toggle-group>
        <button mat-raised-button class="to-basket" color="accent"
                (click)="doAddToBasket(product['id'], product['amount'])">
          <fa-icon [icon]="faCartPlus"></fa-icon>
        </button>
      </mat-card-actions>
    </mat-card>
  </div>

  <div fxFlex="100" fxLayoutAlign="end center">
    <button mat-raised-button (click)="scrollToTop()" color="warn">Наверх</button>
    <mat-paginator [length]="productsCount"
                   [pageSize]="limit"
                   [showFirstLastButtons]=true
                   (page)="pageEvent = getPaginatorData($event)">
    </mat-paginator>
  </div>

</div>
